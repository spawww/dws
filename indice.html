<!DOCTYPE html>
<html lang="it">
<head>
<title>DWS</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="icon" href="favicon.ico?v=0">
<link rel="stylesheet" href="static/css/stile.css">
</head>
<body onLoad=aggiornaTesto();>
<p class="titolo"><img class="large" src="static/images/logo.png" alt="logo"> DWS</p>
<div id="ruota"></div>
</body>

<script>

//const indirizzo = 'https://spawww.github.io/dws/indice.json';
//const indirizzo = 'http://127.0.0.1:8000/indice.json';
const indirizzo = 'indice.json';

var products;

function aggiornaTesto()
{
  fetch(indirizzo)
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    return response.json();
  })
  .then(userData => {
    // Process the retrieved user data
    var listItems = "";
    var numFiles = 0;
    var size = 0;
    userData.forEach(product => {
        listItems += `<a href="${product.percorsoFile}">${product.nomeFile}</a>`;
        listItems += `<br>`;
        listItems += `${product.dataModifica} ${fileSizeReadable(product.sizeFile)}`;
        listItems += `<br>`;
        listItems += `<img src="static/images/separatore.png" alt="--------">`;
        listItems += ` <a href="${product.percorsoFile}" download><img src="static/images/scarica.png" alt="scarica"></a> <br><br>`;
        numFiles += 1;
        size += product.sizeFile;
    });
    const div = document.querySelector("div");
    div.innerHTML = listItems + `<p class="finepagina">${numFiles} files ${fileSizeReadable(size)}.</p>`;
  })
  .catch(error => {
    console.error('Error:', error);
  });
}

function fileSizeReadable(num) {
    for (let unit of ['b','Kb','Mb']) {
        if (Math.abs(num) < 1024.0) {
            return (num.toFixed() + " " + unit);
        }
        num /= 1024.0;
    }
    return (num.toFixed(1) + ' Gb');
}

</script>
</html>
